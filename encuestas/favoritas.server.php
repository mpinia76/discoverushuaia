<?php
function muestraMsg(){
	$objResponse = new xajaxResponse();
	$objResponse->assign('alert', 'style.display', "block");
	$objResponse->assign('formulario', 'style.display', "none");
	return $objResponse;
}
function buscaCliente($values){
	$email=$values['email'];
	$objResponse = new xajaxResponse();
	include("../conex.php");
	include("../db.php");
	$vdir = db_dir();
	$vusr = db_usr();
	$vpass = db_pass();
	$vbase = db_base();
	$link=Conectarse( $vdir, $vusr, $vpass, $vbase);
	$sql="SELECT * FROM clientes WHERE email='".$email."'";

	$rsTemp=mysqli_query($link,$sql,$link);
	if(mysqli_affected_rows($link)==1){
		$rs=mysqli_fetch_array($rsTemp);
		$objResponse->assign("nombre", "value", $rs['nombre']);
		$objResponse->assign("apellido", "value", $rs['apellido']);
		$objResponse->assign("email", "value", $rs['email']);
		$telefono = explode(" ",$rs['telefono']);
		$objResponse->assign("cod_area", "value", $telefono[0]);
		$objResponse->assign("telefono", "value", $telefono[1]);
		$objResponse->assign($rs['tipodoc'],"selected", "selected");
		$objResponse->assign("nrodoc", "value", $rs['nrodoc']);
		$objResponse->assign("email", "value", $rs['email']);
		$objResponse->assign("pais", "value", $rs['pais']);
		$objResponse->assign("provincia", "value", $rs['provincia']); $objResponse->assign("ciudad", "value", $rs['ciudad']); $objResponse->assign("calle", "value", $rs['calle']); $objResponse->assign("nropuerta", "value", $rs['nropuerta']); $objResponse->assign('formulario', 'style.display', ""); $objResponse->assign("alert", "style.display", "none"); }else{ $objResponse->append("alert_text", "innerHTML", "<p>No se encontraron datos con la direcci&oacute;n ingresada</p>"); } return $objResponse; } function tipoDNI($id){ switch ($id){ case 1: $tipo="DNI"; break; case 2: $tipo="CI"; break; case 3: $tipo="LE"; break; case 4: $tipo="LC"; break; } return $tipo; } function procesaPago($values){ $objResponse = new xajaxResponse(); $objResponse->alert($values); return $objResponse; } function tarjeta($indice,$total,$tipo){ $precio=$indice*$total; $objResponse = new xajaxResponse(); $precio=number_format($precio, 2, '.', ''); $objResponse->assign("total_estadia", "innerHTML", "AR$ ".$precio); $objResponse->assign("total_final", "value", $precio); $objResponse->assign("total_abonar", "value", $precio); if($tipo==2){ $objResponse->assign("abonar", "style.display", ""); $objResponse->assign("visa_porcentaje", "style.display",""); $objResponse->assign("a_abonar", "innerHTML", "AR$ ".$precio); $objResponse->assign("a_abonar", "style.display", ""); }else{ $objResponse->assign("abonar", "style.display", "none"); $objResponse->assign("visa_porcentaje", "style.display","none"); $objResponse->assign("a_abonar", "style.display", "none"); } return $objResponse; } function porcentaje($indice,$total,$interes){ $precio_split=$indice*$total; $restante=$total-$precio_split; $precio=$precio_split*$interes; $total=$precio+$restante; $objResponse = new xajaxResponse(); $objResponse->assign("total_final", "value", $total); $objResponse->assign("total_abonar", "value", $precio); $objResponse->assign("total_estadia", "innerHTML", "AR$ ".number_format($total, 2, '.', '')); $objResponse->assign("a_abonar", "innerHTML", "AR$ ".number_format($precio, 2, '.', '')); return $objResponse; } function verSimilar($in,$out,$paxmay,$paxmen,$paxbb,$idhabita,$url){ $id="123409213409281430"; $formato="x"; $nrooperacion=rand(1,1000000); $operacion="d"; $versimilar="1"; $desarrolloespecial="v"; $xml = simplexml_load_file($url.'futurweb/resonline_ext.php?id='.$id.'&nrooperacion='.$nrooperacion.'&operacion=d&in='.$in.'&out='.$out.'&formato='.$formato.'&desarrolloespecial='.$desarrolloespecial.'&idhabita='.$idhabita.'&paxmay='.$paxmay.'&paxmen='.$paxmen.'&paxbb='.$paxbb.'&versimilar='.$versimilar.'') or die("Disculpe, lamentablemente el sistema de reservas no esta disponible por el momento."); if($xml->codrespuesta!=1) { $msg=$xml->error; }else{ $msg.='<span style="font-family:Arial, Helvetica, sans-serif; font-size:14px; font-weight:bold;">Apartamentos similares</span><br />'; foreach($xml->datosadic as $hab){ $sql="SELECT nombre FROM departamentos WHERE id='".$hab->idhabi."'"; include("admin/config.php"); $conn = mysqli_connect($host, $db_user, $db_pass, $db); $rsTemp=mysqli_query($conn,$sql); while($rs=mysqli_fetch_assoc($rsTemp)){ $nombre=utf8_encode($rs['nombre']); } $camas=$hab->camas1plaza+(2*$hab->camas2plaza); $extras=$hab->totalplazas-$camas; $msg.='<p align="left">'; $msg.='<span style="font-family:Arial, Helvetica, sans-serif; font-size:12px; font-weight:bold;">'.$nombre.'</span><br />'; if($hab->camas2plaza!=0){ $msg.='<span style="font-family:Arial, Helvetica, sans-serif; font-size:12px;"><b>Camas 2 plazas:</b> '.$hab->camas2plaza.'</span><br />'; } if($hab->camas1plaza!=0){ $msg.='<span style="font-family:Arial, Helvetica, sans-serif; font-size:12px;"><b>Camas 1 plaza:</b> '.$hab->camas1plaza.'</span><br />'; } if($extras!=0){ $msg.='<span style="font-family:Arial, Helvetica, sans-serif; font-size:12px;"><b>Camas extas disponibles:</b> '.$extras.'</span><br />'; } $nombre=strtolower($nombre); $msg.='<span style="font-family:Arial, Helvetica, sans-serif; font-size:12px;"><b><a href="'.$nombre.'.php">Ver detalles</a></b></span><br />'; $msg.='</p>'; } } $objResponse = new xajaxResponse(); $objResponse->assign('alert', 'style.display', "block"); $objResponse->assign('formulario', 'style.display', "none"); $objResponse->assign("alert_text", "innerHTML", $msg); return $objResponse; } function verDetalle($titulo,$checkin,$checkout,$mayores,$menores,$noches,$extras,$total,$bebes,$nrooperacion,$id,$in,$out){ $msg.='<span style="font-family:Arial, Helvetica, sans-serif; font-size:14px; font-weight:bold;">'.$titulo.'</span><br /><br />'; $msg.='<span style="font-family:Arial, Helvetica, sans-serif; font-size:12px;"><b>Check In:</b> '.$checkin.' a las 15 horas.</span><br />'; $msg.='<span style="font-family:Arial, Helvetica, sans-serif; font-size:12px;"><b>Check Out:</b> '.$checkout.' a las 10 horas.</span><br /><br />'; $msg.='<span style="font-family:Arial, Helvetica, sans-serif; font-size:12px;"><b>Mayores:</b> '.$mayores.' | <b>Menores:</b> '.$menores.' | <b>Beb&eacute;s:</b> '.$bebes.'</span><br /><br />'; $msg.='<span style="font-family:Arial, Helvetica, sans-serif; font-size:12px;"><b>Total de noches:</b> '.$noches.'</span><br /><br />'; if($extras!=""){ $msg.='<span style="font-family:Arial, Helvetica, sans-serif; font-size:12px;"><b>Observaciones:</b> '.$extras.'</span><br /><br />'; } $msg.='<span style="font-family:Arial, Helvetica, sans-serif; font-size:14px; font-weight:bold;">Costo Total: AR$ '.number_format($total, 2, '.', '').'</span><br /><br />'; if($bebes!=0){ $msg.='<span style="font-family:Arial, Helvetica, sans-serif; font-size:11px;"><em>Recuerde solicitar cuna para beb&eacute;s cuando se comunique con el hotel</em></span></div><br /><br />'; } $msg.=' <form method="POST" name="form" action="reservas_iniciar.php"> <input type="hidden" name="total" value="'.$total.'" /> <input type="hidden" name="NROOPERACION" value="'.$nrooperacion.'" /> <input type="hidden" name="id" value="'.$id.'" /> <input type="hidden" name="noches" value="'.$noches.'" /> <input type="hidden" name="titulo" value="'.$titulo.'" /> <input type="hidden" name="in" value="'.$in.'" /> <input type="hidden" name="out" value="'.$out.'" /> <input type="hidden" name="mayores" value="'.$mayores.'" /> <input type="hidden" name="menores" value="'.$menores.'" /> <input type="hidden" name="bebes" value="'.$bebes.'" /> <input type="hidden" name="extras" value="'.$extras.'" /> <input type="submit" name="reservar" value="Reservar" /><br /><br /> </form> '; $objResponse = new xajaxResponse(); $objResponse->assign('alert', 'style.display', "block"); $objResponse->assign('formulario', 'style.display', "none"); $objResponse->assign("alert_text", "innerHTML", $msg); return $objResponse; } function muestraCarga(){ $objResponse = new xajaxResponse(); $objResponse->assign('carga', 'style.display', "block"); return $objResponse; } function processForm($aFormValues){ if ($aFormValues['username']=="" or $aFormValues['password']==""){ $objResponse = new xajaxResponse(); $objResponse->alert("Debe completar el Usuario y la Password"); return $objResponse; }else{ $user=$aFormValues['username']; $pass=$aFormValues['password']; $sql="SELECT id FROM usuarios WHERE usuarios='".$user."' AND pass='".$pass."'"; include("admin/config.php"); $conn = mysqli_connect($host, $db_user, $db_pass, $db); $rsTemp=mysqli_query($conn,$sql); while($rs=mysqli_fetch_assoc($rsTemp)){ $id=$rs['id'];} if($id!=""){ $_SESSION['user']=$user; $objResponse = new xajaxResponse(); $objResponse->assign('form', 'style.display', "none"); $objResponse->assign('encuesta', 'style.display', "block"); return $objResponse; }else{ $objResponse = new xajaxResponse(); $objResponse->alert("Los datos ingresados no son correctos"); return $objResponse; } } } function enviarEmail($aFormValues){ $msg.="Se ha completado una encuesta del cliente ".$_SESSION['user']." \r\n"; $msg.="--------------------------------------------------------------------------------------------- \r\n"; foreach($aFormValues as $clave=>$valor){ if($valor!=""){ $msg.="".$clave.": ".$valor." \r\n"; } } $to="minervinim@villagedelaspampas.com.ar"; mail($to,"Nueva encuesta de satisfaccion",$msg,"From: Village de las Pampas Web"); $sql="DELETE FROM usuarios WHERE usuarios='".$_SESSION['user']."'"; include("admin/config.php"); $conn = mysqli_connect($host, $db_user, $db_pass, $db); $rsTemp=mysqli_query($conn,$sql); $objResponse = new xajaxResponse(); $objResponse->assign('encuesta', 'style.display', "none"); $objResponse->assign('gracias', 'style.display', "block"); return $objResponse; } function eliminarSeleccion($id,$operacion){ $favoritas=$_SESSION[$operacion]; foreach($favoritas as $clave=>$valor){ if($valor==$id){ $favoritas[$clave]="empty"; } } foreach($favoritas as $clave=>$valor){ if($valor!="empty"){ $favoritasTemp[]=$valor;} } $favoritas=@array_values($favoritasTemp); $_SESSION[$operacion]=$favoritas; $objResponse = new xajaxResponse(); $objResponse->remove($id); return $objResponse; } function cerrarVentana() { $objResponse = new xajaxResponse(); $objResponse->assign('alert', 'style.display', "none"); $objResponse->assign('formulario', 'style.display', "block"); return $objResponse; } function nuevoDpto($operacion,$id) { if($operacion==1){ if(isset($_SESSION['favoritas'])){ $favoritas=$_SESSION['favoritas']; if($favoritas[0]==$id or $favoritas[1]==$id or $favoritas[3]==$id){ $msg=3; }else{ if(count($favoritas) < 3){ $favoritas[]=$id; $_SESSION['favoritas']=$favoritas; $msg=1; }else{ $msg=2; } } } else{ $favoritas[]=$id; $_SESSION['favoritas']=$favoritas; $msg=1; } switch($msg) { case 1: $msg="Se ha agregado este departamento como preferencia. Desde la seccion Contacto puede pedir mas informacion al respecto o continuar navegando por el sitio.<br><br>"; break; case 2: $msg="Ya ha seleccionado tres deparamentos como preferencia. Por favor dirigase a la seccion Contacto para solicitar mas informacion o eliminar alguno de los seleccionados.<br><br>"; break; case 3: $msg="Este departamento ya ha sido seleccionado.<br><br>"; break; } $objResponse = new xajaxResponse(); $objResponse->assign("alert_text", "innerHTML", $msg); $objResponse->assign('alert', 'style.display', "block"); return $objResponse; }elseif($operacion==2){ if(isset($_SESSION['reserva'])){ $favoritas=$_SESSION['reserva']; if($favoritas[0]==$id or $favoritas[1]==$id or $favoritas[3]==$id){ $msg=3; }else{ if(count($favoritas) < 3){ $favoritas[]=$id; $_SESSION['reserva']=$favoritas; $msg=1; }else{ $msg=2; } } } else{ $favoritas[]=$id; $_SESSION['reserva']=$favoritas; $msg=1; } switch($msg) { case 1: $msg="Se ha agregado este apartamento como de su preferencia. Desde la seccion <a href=reservas.php>Reservas on-line</a> puede consultar disponibilidad para la fecha de su inter&eacute;s y realizar su reserva en solo 3 pasos.Usted puede consultar por hasta 3 apartamentos de manera simultanea.<br><br>"; break; case 2: $msg="Ya ha seleccionado tres deparamentos como preferencia. Por favor dirigase a la seccion Contacto para solicitar mas informacion o eliminar alguno de los seleccionados.<br><br>"; break; case 3: $msg="Este departamento ya ha sido seleccionado.<br><br>"; break; } $objResponse = new xajaxResponse(); $objResponse->assign('alert', 'style.display', "block"); $objResponse->assign("alert_text", "innerHTML", $msg); return $objResponse; } } require("favoritas.common.php"); $xajax->processRequest();
